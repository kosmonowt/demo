<!doctype HTML>
<!-- All new Code by Andreas Kosmowicz. Initially generated by bootstrap. -->
<!-- Intranet Applikation für Außendienstberater. Still in development. -->
<!-- Uses Zepto, Ratchet und Dojo-->
<html manifest="curitiba.appcache">
	<head>
		<script type="text/javascript" src="js/zepto.min.js"></script>
		<script type="text/javascript" src="dojo/dojo.js"></script>
		<script type="text/javascript" src="js/ratchet.min.js"></script>
	    <meta charset="utf-8">
    	<title>Curitiba - Berichterstattung im Außendienst</title>
	
	    <!-- Sets initial viewport load and disables zooming  -->
	    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
	
	    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	
	    <!-- Include the compiled Ratchet CSS -->
	    <link href="dijit/themes/claro/claro.css" rel="stylesheet" media="screen">
	    <link href="css/ratchet.css" rel="stylesheet">
	    <link href="css/app.css" rel="stylesheet">
	</head>
	<body class="claro">
	    <!-- Make sure all your bars are the first things in your <body> -->
	    <header class="bar bar-nav">
	      <h1 id="headline" class="title">Curitiba - Berichterstattung im Außendienst</h1>
	    </header>	
		<div class="content tab" id="home">
			<div class="">
			</div>	
		</div>
		<div class="content tab hidden" id="regions">
			<ul class="table-view" id="regionsTable">
			</ul>
		</div>
		<div class="content tab hidden" id="sucursals">
			<ul class="table-view" id="sucursalsTable">
			</ul>		
		</div>
		<div class="content tab hidden" id="sucursal_reports">
			<ul class="table-view" id="sucursalReportsTable">
			</ul>		
		</div>		
		<div class="content tab hidden" id="reports">
			<ul class="table-view" id="reportsTable">
			</ul>
		</div>
		<div class="content content-padded tab hidden" id="reportDetails">
		</div>		
		<div class="content content-padded tab hidden" id="files">
		</div>
		<div class="content tab hidden" id="settings">
			<ul class="table-view">
			  <li class="table-view-cell media">
			    <a class="navigate-right">
			      <span class="media-object pull-left icon icon-person"></span>
			      <div class="media-body" data-to="#" data-form="addPersonForm">
			        Person hinzufügen
			      </div>
			    </a>
			  </li>
			  <li class="table-view-cell media">
			    <a class="navigate-right">
			      <span class="media-object pull-left icon icon-edit"></span>
			      <div class="media-body" data-form="addSucursalForm">
			        Filiale hinzufügen
			      </div>
			    </a>
			  </li>
			  <li class="table-view-cell media">
			    <a class="navigate-right">
			      <span class="media-object pull-left icon icon-pages"></span>
			      <div class="media-body">
			        Item 3
			      </div>
			    </a>
			  </li>
		  	</ul>			
		</div>
		<div class="content content-padded tab hidden" id="forms">
			
		</div>
		<div class="content content-padded loader" id="loader"><img src="img/ajax-loader.gif"></div>
		<nav class="bar bar-tab">
		  <a class="tab-item active" href="#" data-to="#home">
		    <span class="icon icon-home"></span>
		    <span class="tab-label">Home</span>
		  </a>
		  <a class="tab-item" href="#regions" data-to="#regions" data-content="showRegions">
		    <span class="icon icon-bars"></span>
		    <span class="tab-label">Regionen</span>
		  </a>
		  <a class="tab-item" href="#reports" data-to="#reports" data-content="showReports">
		    <span class="icon icon-pages"></span>
		    <span class="tab-label">Berichte</span>
		  </a>
		  <a class="tab-item" href="#files" data-to="#files" data-content="addFileForm">
		    <span class="icon icon-pages"></span>
		    <span class="tab-label">Dateien</span>
		  </a>		  
		  <a class="tab-item" href="#settings" data-to="#settings">
		    <span class="icon icon-gear"></span>
		    <span class="tab-label">Settings</span>
		  </a>
		</nav>
		<script type="text/javascript" src="js/app.js"></script>
		<script type="text/javascript">			
			loadedTabs = [];
			$(".tab-item").on("click",function(event){
				if (!$(this).hasClass("blocked")) {
					$(".tab-item").removeClass("active");
					$(this).toggleClass("active");
					openTab($(this).data("to"));
					var tabContentFunction = $(this).data("content");
					if (loadedTabs.indexOf(tabContentFunction) == -1) {
						loadedTabs.push(tabContentFunction);
						eval(tabContentFunction+"()");
					}
				}
			});
			$("#settings .media-body").on("click",function(event){
				openTab("#forms");
				eval ($(this).data("form")+"()");
			});
			$("#navigate-right").on("click",function(event){
				var to = $(this).data("to");
				var id = $(this).data("id");
				var content = $(this).data("content");
				openTab(to);
				eval (content+"("+id+")");
			});

			// Upload
			// Variable to store your files
			var files;
			 
			// Add events
			$('input[type=file]').on('change', prepareUpload);
			 
			// Grab the files and set them to our variable
			function prepareUpload(event)
			{
			  files = event.target.files;
			}

			$('#fileUpload').on('submit', uploadFiles);
 
			// Catch the form submit and upload the files
			function uploadFiles(event)
			{
			  	event.stopPropagation(); // Stop stuff happening
			    event.preventDefault(); // Totally stop stuff happening
			 
			    // START A LOADING SPINNER HERE
			 
			    // Create a formdata object and add the files
				var data = new FormData();
				$.each(files, function(key, value)
				{
					data.append(key, value);
				});
			    
			    $.ajax({
			        url: 'api/Files/upload',
			        type: 'POST',
			        data: data,
			        cache: false,
			        dataType: 'json',
			        processData: false, // Don't process the files
			        contentType: false, // Set content type to false as jQuery will tell the server its a query string request
			        success: function(data, textStatus, jqXHR)
			        {
			        	if(typeof data.error === 'undefined')
			        	{
			        		// Success so call function to process the form
			        		submitForm(event, data);
			        	}
			        	else
			        	{
			        		// Handle errors here
			        		console.log('ERRORS: ' + data.error);
			        	}
			        },
			        error: function(jqXHR, textStatus, errorThrown)
			        {
			        	// Handle errors here
			        	console.log('ERRORS: ' + textStatus);
			        	// STOP LOADING SPINNER
			        }
			    });
			}


		</script>
	</body>
</html>
